language: python
install:
 - git clone https://github.com/w3c/respec.git
 - git clone https://github.com/dontcallmedom/webidl-checker.git
 - git clone https://github.com/dontcallmedom/widlproc
 - git clone https://github.com/halindrome/linkchecker.git
 - sudo apt-get install cpanminus
 - cpanm --local-lib=~/perl5 local::lib && eval $(perl -I ~/perl5/lib/perl5/ -Mlocal::lib)
 - cd linkchecker && cpanm --local-lib=~/perl5 --quiet --notest . && cd ..
 - cpanm --local-lib=~/perl5 --quiet --notest LWP::Protocol::https
 - cd widlproc && make obj/widlproc && cd ..
 - pip install html5lib lxml
script:
 - phantomjs --ignore-ssl-errors=true --ssl-protocol=tlsv1 respec/tools/respec2html.js -e -w getusermedia.html output.html
 - python webidl-checker/webidl-check output.html
 - "! (perl -T linkchecker/bin/checklink -S 0  -q --suppress-all-redirects output.html |grep  \"^\")"
env: WIDLPROC_PATH=$TRAVIS_BUILD_DIR/widlproc/obj/widlproc
